<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SNMP Monitoring</title>
    <style>
        /* General Body Styles */
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: #f0f2f5;
            margin: 0;
            color: #333;
        }

        /* --- Inline Filter Bar --- */
        #filter-container {
            display: none; /* Hidden by default */
            position: relative; /* Anchor for the close button */
            padding: 20px 50px 20px 20px; /* Extra padding on the right for the close button */
            background-color: #e9ecef;
            border-bottom: 1px solid #dee2e6;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 20px;
        }

        #filter-input {
            width: 50%;
            max-width: 500px;
            padding: 12px 20px;
            font-size: 18px;
            border-radius: 50px;
            border: 1px solid #ccc;
        }
        #filter-input:focus {
            outline: none;
            border-color: #007bff;
        }
        
        /* Zoom Slider Control */
        .zoom-control {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #555;
        }
        #zoom-slider {
            width: 150px;
        }

        /* --- MODIFIED: Close Button --- */
        #close-btn {
            position: absolute;
            top: 50%;
            right: 15px;
            transform: translateY(-50%);
            background: transparent;
            border: none;
            font-size: 28px;
            color: #6c757d;
            cursor: pointer;
            padding: 0 10px;
            line-height: 1;
        }
        #close-btn:hover {
            color: #343a40;
        }


        /* Dynamic Grid Layout */
        .dashboard-grid {
            display: grid;
            --card-zoom-factor: 1; 
            --card-base-width: 280px; 
            grid-template-columns: repeat(auto-fill, minmax(calc(var(--card-base-width) * var(--card-zoom-factor)), 1fr));
            gap: 15px;
            padding: 15px;
        }

        /* Switch Card with Overlay Name */
        .switch-card {
            background-color: #ffffff;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.08);
            position: relative;
            transition: opacity 0.2s;
        }

        .card-link {
            display: block;
            text-decoration: none;
            color: inherit;
        }
        
        .switch-name {
            position: absolute;
            top: 8px;
            right: 8px;
            background: rgba(0, 0, 0, 0.65);
            color: white;
            padding: 3px 10px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: bold;
            z-index: 1;
        }
        
        .switch-card-image {
            display: block;
            max-width: 100%;
            height: auto;
            border-radius: 8px;
        }
        
        /* Styles for commented-out switches */
        .switch-card.inactive {
            opacity: 0.4;
            filter: grayscale(80%);
            pointer-events: none;
        }
        
        /* Usability Hint */
        .hint {
            position: fixed; bottom: 10px; left: 50%; transform: translateX(-50%); background: rgba(0, 0, 0, 0.7);
            color: white; padding: 5px 15px; border-radius: 20px; font-size: 12px; opacity: 1;
            transition: opacity 0.5s ease 2s; pointer-events: none;
        }
        .hint--hidden {
            opacity: 0;
        }
    </style>
</head>
<body>

    <div id="filter-container">
        <input type="text" id="filter-input">
        <div class="zoom-control">
            <label for="zoom-slider">Zoom:</label>
            <input type="range" id="zoom-slider" min="50" max="200" value="100">
        </div>
        <button id="close-btn" title="Close (Esc)">&times;</button>
    </div>

    <main class="dashboard-grid" id="dashboard-grid">
        <!-- Switch cards are dynamically inserted here -->
    </main>
    
    <div class="hint" id="hint">Start typing to filter...</div>


    <script>
        // --- DATA STRUCTURE ---
        const activeSwitchNames = ['sw-core', 'sw-dpc-1', 'sw-dpc-2', 'sw-r1sfp', 'sw-rack1', 'sw-ganeti', 'sw-rack2', 'sw-lib-srv (rack3)', 'sw-a000-j', 'sw-a000-s', 'sw-a100-j', 'sw-a100-j-2', 'sw-a100-s', 'sw-a121', 'sw-a125a', 'sw-a125-ss', 'sw-a200', 'sw-a200-j', 'sw-a200-j-2', 'sw-a200-s', 'sw-a204', 'sw-a212', 'sw-a212-2', 'sw-a215', 'sw-aula', 'sw-aula-2', 'sw-b000', 'sw-b000-2', 'sw-b100', 'sw-b100-2', 'sw-b200', 'sw-b200-2', 'sw-b300', 'sw-baraka', 'sw-c000', 'sw-c000-2', 'sw-c100', 'sw-c200', 'sw-c300', 'sw-c300-2', 'sw-ctrl', 'sw-dekanat', 'sw-dekanat-2', 'sw-e300', 'sw-e300-2', 'sw-fond-1', 'sw-fond', 'sw-lib', 'sw-lib-a', 'sw-lib-b', 'sw-lib-c', 'sw-lib-cr1', 'sw-lib-d', 'sw-lib-e', 'sw-lib-f', 'sw-lib-g', 'sw-lib-h', 'sw-lib-i', 'sw-lib-j', 'sw-lib-k', 'sw-lib-l', 'sw-lib-m', 'sw-lib-n', 'sw-lib-o', 'sw-lib-p', 'sw-lib-q', 'sw-lib-r', 'sw-lib-s', 'sw-lib-zs', 'sw-lib-wifi'];
        const commentedSwitchNames = ['sw-cpf', 'sw-dpc', 'sw-b101', 'sw-b101-n'];

        // --- DYNAMIC DATA GENERATION ---
        function generateSwitchData(activeNames, commentedNames) {
            const GRAPH_URL_TEMPLATE = "https://munin.ffzg.hr/munin-cgi/munin-cgi-graph/snmp/{ID}/if_bytes-day.png";
            const DETAILS_URL_TEMPLATE = "https://munin.ffzg.hr/snmp/{ID}/index.html";
            const createObject = (displayName, isActive) => ({ switch_name: displayName, graph_url: GRAPH_URL_TEMPLATE.replace('{ID}', displayName.split(' ')[0]), details_url: DETAILS_URL_TEMPLATE.replace('{ID}', displayName.split(' ')[0]), isActive });
            return activeNames.map(name => createObject(name, true)).concat(commentedNames.map(name => createObject(name, false)));
        }

        // --- DOM ELEMENTS ---
        const grid = document.getElementById('dashboard-grid');
        const filterContainer = document.getElementById('filter-container');
        const filterInput = document.getElementById('filter-input');
        const zoomSlider = document.getElementById('zoom-slider');
        const closeBtn = document.getElementById('close-btn');
        const hint = document.getElementById('hint');
        const switchData = generateSwitchData(activeSwitchNames, commentedSwitchNames);

        // --- FUNCTIONS ---
        function renderSwitches(switches) {
            grid.innerHTML = '';
            switches.forEach(sw => {
                const card = document.createElement('div');
                card.className = `switch-card ${sw.isActive ? '' : 'inactive'}`;
                card.innerHTML = `<a href="${sw.details_url}" target="sw" class="card-link"><div class="switch-name">${sw.switch_name}</div><img src="${sw.graph_url}" alt="Traffic graph for ${sw.switch_name}" class="switch-card-image"></a>`;
                grid.appendChild(card);
            });
        }

        function runFilter() {
            const searchTerm = filterInput.value;
            try {
                const regex = new RegExp(searchTerm, 'i');
                renderSwitches(switchData.filter(sw => regex.test(sw.switch_name)));
            } catch (e) {
                renderSwitches(switchData); // On invalid regex, show all
            }
        }
        
        function hideFilter() {
            filterInput.value = '';
            filterContainer.style.display = 'none';
            runFilter(); // Reset view to all switches
        }

        // --- EVENT LISTENERS ---
        filterInput.addEventListener('keyup', runFilter);
        
        zoomSlider.addEventListener('input', () => {
            grid.style.setProperty('--card-zoom-factor', zoomSlider.value / 100);
        });

        closeBtn.addEventListener('click', hideFilter);

        window.addEventListener('keydown', (event) => {
            // If the user presses Escape, hide the filter.
            if (event.key === 'Escape') {
                hideFilter();
                return;
            }
            
            // Do nothing if the user is already typing in an input.
            if (document.activeElement === filterInput || document.activeElement === zoomSlider) return;

            // Only activate on single character keys (ignore Ctrl, Shift, etc.).
            if (event.key.length === 1) {
                filterContainer.style.display = 'flex'; // Show the header
                filterInput.focus();
                filterInput.value = event.key;
                runFilter();
                
                event.preventDefault(); // Prevent the key from being typed anywhere else.
            }
        });

        // --- INITIALIZATION ---
        renderSwitches(switchData);
        setTimeout(() => hint.classList.add('hint--hidden'), 1000);

    </script>
</body>
</html>